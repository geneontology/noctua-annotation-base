<div [attr.id]="activity.displayId" fxLayout="column" fxLayoutAlign="start stretch" class="w-100-p"
  [ngClass]="{'noc-selected': activity.displayId===camsService.currentMatch?.activityDisplayId}">
  <div class="noc-activity-heading" fxLayout="row" fxLayoutAlign="start center">
    <div fxFlex="25px" (click)="$event.stopPropagation()">
      <button mat-icon-button (click)="toggleExpand(activity)" color="primary" class="noc-toggle-expand-button">
        <fa-icon *ngIf="!activity.expanded" [icon]="['fas', 'caret-right']"></fa-icon>
        <fa-icon *ngIf="activity.expanded" [icon]="['fas', 'caret-down']"></fa-icon>
      </button>
    </div>
    <div class="noc-display-number noc-sm" (click)="$event.stopPropagation()">
      {{activity.displayNumber}}
    </div>
    <div class="noc-title mr-12" fxLayout="row" fxLayoutAlign="start center">
      <div class="noc-gp" *ngIf="gpNode" fxLayout="column" fxLayoutAlign="center start">
        <span class="text-truncate">
          {{gpNode.term?.label}}
        </span>
        <a class="text-truncate" (click)="$event.stopPropagation()" href="{{gpNode.term?.url}}" target="_blank">
          {{ gpNode.term?.id }}
        </a>
      </div>
    </div>
    <mat-chip class="noc-chip-xs" [ngClass]="activity.activityType">
      <span>{{activityTypeOptions[activity.activityType]?.label}}</span>
    </mat-chip>
    <div *ngIf="activity.hasViolations" class="noc-error" fxLayout="row" fxLayoutAlign="start center">
      <mat-chip class="noc-error-chip noc-chip-xs ml-8" fxLayout="row" fxLayoutAlign="start center"
        (click)="displayActivityErrors(activity)">
        <div class="noc-icon">
          <fa-icon [icon]="['fas', 'exclamation-triangle']"></fa-icon>
        </div>
        <div fxFlex="" class="noc-chip-label">
          {{activity.violations?.length}} Errors Found
        </div>
      </mat-chip>
    </div>
    <span fxFlex=""></span>
  </div>
  <div *ngIf="activity.expanded" class="noc-tree-container">
    <mat-tree #tree *ngIf="dataSource?.data" [dataSource]="dataSource" [treeControl]="treeControl">
      <mat-tree-node class="noc-tree-node" *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding
        matTreeNodePaddingIndent="16" [ngClass]="{ 'background-highlight': activeAnnotation === node.uuid}">
        <div class="w-100-p" fxLayout="row" fxLayoutAlign="start center">
          <button mat-icon-button disabled class="noc-icon-button"></button>
          <div class="noc-annotation-row" fxFlex="" fxLayout="row" fxLayoutAlign="start center">
            <div class="noc-cell-label">
              {{node.label}}
            </div>
            <noc-activity-tree-node [options]="options" [cam]="cam" [activity]="activity" [entity]="node"
              class="w-100-p">
            </noc-activity-tree-node>
          </div>
        </div>
      </mat-tree-node>
      <mat-tree-node fxLayout="row" class="noc-tree-node" *matTreeNodeDef="let node;when: hasChild" matTreeNodePadding
        matTreeNodePaddingIndent="16" [ngClass]="{ 'background-highlight': activeAnnotation === node.uuid}">
        <div class="w-100-p" fxLayout="row" fxLayoutAlign="start center">
          <div class="noc-annotation-row" fxFlex="" fxLayout="column" fxLayoutAlign="start stretch">
            <div class="noc-cell-label">
              {{node.label}}
            </div>
            <noc-activity-tree-node [options]="options" [cam]="cam" [activity]="activity" [entity]="node"
              class="w-100-p">
            </noc-activity-tree-node>
          </div>
        </div>
      </mat-tree-node>
    </mat-tree>
  </div>
</div>